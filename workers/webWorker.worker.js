!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.html_spaceship=e():t.html_spaceship=e()}(this,(()=>(()=>{"use strict";var t={};(t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})})(t);const e=function(t,e,i,s){this.x=t,this.y=e,this.height=i,this.width=s};function i(t){return e=this,i=void 0,o=function(){return function(t,e){var i,s,o,n,r={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return n={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function a(n){return function(a){return function(n){if(i)throw new TypeError("Generator is already executing.");for(;r;)try{if(i=1,s&&(o=2&n[0]?s.return:n[0]?s.throw||((o=s.return)&&o.call(s),0):s.next)&&!(o=o.call(s,n[1])).done)return o;switch(s=0,o&&(n=[2&n[0],o.value]),n[0]){case 0:case 1:o=n;break;case 4:return r.label++,{value:n[1],done:!1};case 5:r.label++,s=n[1],n=[0];continue;case 7:n=r.ops.pop(),r.trys.pop();continue;default:if(!((o=(o=r.trys).length>0&&o[o.length-1])||6!==n[0]&&2!==n[0])){r=0;continue}if(3===n[0]&&(!o||n[1]>o[0]&&n[1]<o[3])){r.label=n[1];break}if(6===n[0]&&r.label<o[1]){r.label=o[1],o=n;break}if(o&&r.label<o[2]){r.label=o[2],r.ops.push(n);break}o[2]&&r.ops.pop(),r.trys.pop();continue}n=e.call(t,r)}catch(t){n=[6,t],s=0}finally{i=o=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,a])}}}(this,(function(e){switch(e.label){case 0:return[4,fetch(t)];case 1:return[4,e.sent().blob()];case 2:return[2,e.sent()]}}))},new((s=void 0)||(s=Promise))((function(t,n){function r(t){try{h(o.next(t))}catch(t){n(t)}}function a(t){try{h(o.throw(t))}catch(t){n(t)}}function h(e){var i;e.done?t(e.value):(i=e.value,i instanceof s?i:new s((function(t){t(i)}))).then(r,a)}h((o=o.apply(e,i||[])).next())}));var e,i,s,o}var s,o=(s=function(t,e){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])},s(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function i(){this.constructor=t}s(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),n=0,r={idle:null,poof:null};const a=function(t){function e(e,i){var s=e.x,o=e.y,r=t.call(this,s,o,20,20)||this;return r.speed=8,r.velocity={x:i.x*r.speed,y:i.y*r.speed},r.id=n++,r.currAction="idle",r.spriteIdx=0,r.status="alive",r}return o(e,t),e.prototype.draw=function(t){"dead"!==this.status&&(t.drawImage(r[this.currAction][this.spriteIdx],this.x-this.width/2,this.y-this.height/2,this.width,this.height),this.resetSpriteIdx(),this.increaseSpriteIdx())},e.prototype.updatePosition=function(){this.x+=this.velocity.x,this.y+=this.velocity.y},e.prototype.increaseSpriteIdx=function(){this.spriteIdx++},e.prototype.resetSpriteIdx=function(t){(this.spriteIdx===r[this.currAction].length-1||t)&&(this.spriteIdx=0)},e.prototype.updateAction=function(t){t!==this.currAction&&this.resetSpriteIdx("override"),this.currAction=t},e.prototype.update=function(t){if(this.x<0||this.x>t.x||this.y<0||this.y>t.y)this.status="dead";else switch(this.status){case"alive":this.updatePosition();break;case"dieing":this.spriteIdx===r[this.currAction].length-1&&(this.status="dead")}},e.prototype.onHit=function(){this.updateAction("poof"),this.status="dieing"},e.prototype.getCenter=function(){return{x:this.x+this.width/2,y:this.y+this.height/2}},e}(e);!function(){function t(t){void 0===t&&(t="#1DB954"),this.el=document.createElement("canvas"),this.el.classList.add("space"),document.documentElement.appendChild(this.el),this.setCorrectSize(),this.scoreColor=t}t.prototype.setCorrectSize=function(){this.el.height=window.innerHeight,this.el.width=window.innerWidth},t.prototype.draw=function(t,e){var i=this.el.getContext("2d");if(i){i.globalAlpha=1,i.clearRect(0,0,window.innerWidth,window.innerHeight),t.bullets.forEach((function(t){return t.draw(i)})),t.draw(i);for(var s=e.toString(),o="",n=0;n<10-s.length;n++)o+="0";var r=i.measureText(o+s).width,a=i.measureText(s).width,h=r/2,c=window.innerWidth/2+h-a;i.font="3em monospace",i.globalAlpha=.75,i.fillStyle=this.scoreColor,i.fillText(s,c,48),i.globalAlpha=.4,i.fillText(o,window.innerWidth/2-h,48)}},t.prototype.remove=function(){this.el.remove()}}();var h=function(){function t(t,e){void 0===e&&(e="#1DB954"),this.offscreen=t,this.scoreColor=e}return t.prototype.draw=function(t,e,i){var s=this.offscreen.getContext("2d");if(s){s.globalAlpha=1,s.clearRect(0,0,t.width,t.height),e.bullets.forEach((function(t){return t.draw(s)})),e.draw(s);for(var o=i.toString(),n="",r=0;r<10-o.length;r++)n+="0";var a=s.measureText(n+o).width,h=s.measureText(o).width,c=a/2,l=t.width/2+c-h;s.font="3em monospace",s.globalAlpha=.75,s.fillStyle=this.scoreColor,s.fillText(o,l,48),s.globalAlpha=.4,s.fillText(n,t.width/2-c,48)}},t}();function c(t){return t*t}function l(t,e){return Math.sqrt(c(t.x-e.x)+c(t.y-e.y))}const u=function(){function t(t,e){this.x=t,this.y=e}return t.fromPoints=function(e,i){return new t(i.x-e.x,i.y-e.y)},t.fromVector=function(e){return new t(e.x,e.y)},t.prototype.dot=function(t){return t.x*this.x+t.y*this.y},t.prototype.getCrossProduct=function(t){return this.x*t.y-this.y*t.x},t.prototype.toLeftNormal=function(){var t=this.x;return this.x=this.y,this.y=-t,this},t.prototype.toRightNormal=function(){var t=this.x;return this.x=-this.y,this.y=t,this},t.prototype.getMagnitude=function(){return Math.sqrt(c(this.x)+c(this.y))},t.prototype.normalize=function(){var t=this.getMagnitude();return t>.99&&t<1.01||(this.x/=t,this.y/=t),this},t.prototype.multiply=function(t){return this.x*=t,this.y*=t,this},t}();function A(t){return{x:t.x+t.width/2,y:t.y+t.height/2}}function p(t,e){var i=e.y<=t.y+t.height&&e.y+e.height>t.y;return t.x<=e.x+e.width&&e.x<=t.x+t.width&&i}function y(t,e){var i=A(t),s=i.x,o=i.y,n=A(e),r=n.x,a=n.y;return Math.sqrt(c(r-s)+c(a-o))<=t.width/2+e.width/2}function d(t){for(var e=[],i=0;i<t.length;i++){var s=u.fromPoints(t[i],t[(i+1)%t.length]).toRightNormal();e.push(s)}return e}function f(t,e){for(var i=u.fromVector(e).normalize(),s=1/0,o=-1/0,n=0;n<t.length;n++){var r=i.dot(t[n]);s=Math.min(r,s),o=Math.max(r,o)}return{min:s,max:o}}function g(t,e){for(var i=1/0,s=new u(0,0),o=d(t.vertices),n=0,r=d(e.vertices).concat(o);n<r.length;n++){var a=r[n],h=f(t.vertices,a),c=f(e.vertices,a),l=i;if((i=Math.min(Math.min(h.max,c.max)-Math.max(h.min,c.min),i))!=l&&(s=a),c.max<h.min||h.max<c.min)return null}var A=u.fromPoints(t.center,e.center);return A.normalize(),{displacement:A.multiply(i),collisionNormal:s}}function v(t,e){var i=u.fromVector(e).normalize();i.multiply(t.radius);var s=A(t),o=s.x,n=s.y,r={x:o+i.x,y:n+i.y},a={x:o-i.x,y:n-i.y};i.normalize();var h=i.dot(r),c=i.dot(a);if(h>c){var l=h;h=c,c=l}return{min:h,max:c}}function x(t,e){for(var i=1/0,s=new u(0,0),o=0,n=d(t.vertices);o<n.length;o++){var r=n[o],a=f(t.vertices,r),h=v(e,r);if(h.max<a.min||a.max<h.min)return null;var c=i;(i=Math.min(Math.min(a.max,h.max)-Math.max(a.min,h.min),i))!=c&&(s=r)}var p=A(e),y=function(t,e){for(var i=e[0],s=l(i,t),o=1;o<e.length;o++){var n=l(e[o],t);n<s&&(i=e[o],s=n)}return i}(p,t.vertices),g=u.fromPoints(p,y),x=f(t.vertices,g),m=v(e,g);if(m.max<x.min||x.max<m.min)return null;var w=i;(i=Math.min(Math.min(x.max,m.max)-Math.max(x.min,m.min),i))!=w&&(s=g);var b=u.fromPoints(p,t.center);return b.normalize(),{displacement:b.multiply(i),collisionNormal:s}}var m=["left","right","down","up"],w=100,b=function(){var t=function(e,i){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])},t(e,i)};return function(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function s(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(s.prototype=i.prototype,new s)}}(),E=function(t){function e(e){var i=this,s=e.getBoundingClientRect(),o=s.x,n=s.y,r=s.height,a=s.width;return(i=t.call(this,o,n,r,a)||this).el=e,i.center={x:i.x+i.width/2,y:i.y+i.height/2},i}return b(e,t),e.prototype.update=function(){var t=this.el.getBoundingClientRect(),e=t.x,i=t.y,s=t.height,o=t.width;this.x=e,this.y=i,this.height=s,this.width=o,this.center={x:this.x+this.width/2,y:this.y+this.height/2}},e}(e),C=function(t){function e(e){var i=t.call(this,e)||this;return i.kind="circle",i.radius=i.width/2,i}return b(e,t),e}(E),S=function(t){function e(e){var i=t.call(this,e)||this;return i.kind="rect",i.vertices=[{x:i.x,y:i.y},{x:i.x+i.width,y:i.y},{x:i.x+i.width,y:i.y+i.height},{x:i.x,y:i.y+i.height}],i}return b(e,t),e.prototype.update=function(){var t=this.el.getBoundingClientRect(),e=t.x,i=t.y,s=t.height,o=t.width;this.x=e,this.y=i,this.height=s,this.width=o,this.vertices=[{x:this.x,y:this.y},{x:this.x+this.width,y:this.y},{x:this.x+this.width,y:this.y+this.height},{x:this.x,y:this.y+this.height}],this.center={x:this.x+this.width/2,y:this.y+this.height/2}},e}(E),M=function(){function t(){this.list=this.getList()}return t.prototype.getList=function(){return Array.from(document.querySelectorAll(".boundary")).map((function(t){return"50%"===window.getComputedStyle(t).borderRadius?new C(t):new S(t)}))},t.prototype.removeBoundary=function(t){this.list.splice(t,1)},t}();const B=function(){function t(t,e){this.timeout=null,this.lastTime=0,this.onTimerEnd=t,this.interval=e,this.loop=this.loop.bind(this)}return t.prototype.loop=function(){var t=Date.now()-this.lastTime,e=Math.max(this.interval-t,0);this.timeout=setTimeout(this.loop,e),this.onTimerEnd(),this.lastTime=Date.now()},t.prototype.start=function(){this.timeout=setTimeout(this.loop,this.interval)},t.prototype.stop=function(){this.timeout&&clearTimeout(this.timeout),this.timeout=null},t}(),P=function(){function t(){this.keys={left:{pressed:!1},right:{pressed:!1},up:{pressed:!1},down:{pressed:!1},click:{pressed:!1,timer:null}}}return t.prototype.setTimer=function(t,e,i){var s;this.keys[t].timer||(this.keys[t].timer=new B(e,i),null===(s=this.keys[t].timer)||void 0===s||s.start())},t.prototype.removeTimer=function(){var t;null===(t=this.keys.click.timer)||void 0===t||t.stop(),this.keys.click.timer=null},t}(),O=function(){function t(){this.total=0,this.display=0,this.incrementedTotal=0}return t.prototype.updateTotal=function(t){this.total+=Math.floor(t.height*t.width/7)},t.prototype.updateDisplay=function(){if(this.display!==this.total){var t=this.total-this.display,e=0;this.incrementedTotal<10||t<10?e=1:this.incrementedTotal<100||t<100?e=10:this.incrementedTotal<1e3||t<1e3?e=100:this.incrementedTotal<1e4||t<1e4?e=1e3:(this.incrementedTotal<1e5||t<1e5)&&(e=1e4),this.display+=e,this.incrementedTotal+=e,this.display>this.total&&(this.display=this.total)}else this.incrementedTotal=0},t}();var T=function(){var t=function(e,i){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])},t(e,i)};return function(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function s(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(s.prototype=i.prototype,new s)}}();const R=function(t){function e(e,i,s,o,n){var r=t.call(this,e,i,o,s)||this;return r.lifePoints=50,r.el=n,r.circle="50%"===window.getComputedStyle(n).borderRadius,r}return T(e,t),e.prototype.removeEl=function(t){this.el.classList.add(t)},e.prototype.onHit=function(t){this.lifePoints-=10,this.shake(t)},e.prototype.shake=function(t){var e="y"===t?"quake_y":"quake_x";this.el.classList.remove("quake_x","quake_y"),this.el.offsetWidth,this.el.classList.add(e)},e.prototype.update=function(){var t=this.el.getBoundingClientRect(),e=t.x,i=t.y,s=t.height,o=t.width;this.x=e,this.y=i,this.height=s,this.width=o},e}(e),I=function(){function t(){this.list=this.getList()}return t.prototype.getList=function(){return Array.from(document.querySelectorAll(".shootable_el")).map((function(t){var e=t.getBoundingClientRect(),i=e.x,s=e.y,o=e.height,n=e.width;return new R(i,s,n,o,t)}))},t.prototype.removeEl=function(t,e){this.list[t].removeEl(e),this.list.splice(t,1)},t}(),k=function(){function t(t,e){this.vertices=t,this._oldTheta=0,this.center=e}return t.prototype.rotate=function(t,e){var i=this;this.vertices=this.vertices.map((function(s){return{x:(s.x-e.x)*Math.cos(t-i._oldTheta)-(s.y-e.y)*Math.sin(t-i._oldTheta)+e.x,y:(s.x-e.x)*Math.sin(t-i._oldTheta)+(s.y-e.y)*Math.cos(t-i._oldTheta)+e.y}})),this.center={x:(this.center.x-e.x)*Math.cos(t-this._oldTheta)-(this.center.y-e.y)*Math.sin(t-this._oldTheta)+e.x,y:(this.center.x-e.x)*Math.sin(t-this._oldTheta)+(this.center.y-e.y)*Math.cos(t-this._oldTheta)+e.y},this._oldTheta=t},t.prototype.updateXPosition=function(t){for(var e=0;e<this.vertices.length;e++)this.vertices[e].x+=t;this.center.x+=t},t.prototype.updateYPosition=function(t){for(var e=0;e<this.vertices.length;e++)this.vertices[e].y+=t;this.center.y+=t},t}();var _=function(){var t=function(e,i){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])},t(e,i)};return function(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function s(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(s.prototype=i.prototype,new s)}}(),U=function(t,e,i,s,o,n,r,a){var h={upperLeft:0,upperRight:0,lowerLeft:0,lowerRight:0};if(void 0===a&&(a=!0),"object"==typeof n){var c=void 0;for(c in n){var l=n[c];if(void 0===l)return;h[c]=l}}t.beginPath(),t.moveTo(e+h.upperLeft,i),t.lineTo(e+s-h.upperRight,i),t.quadraticCurveTo(e+s,i,e+s,i+h.upperRight),t.lineTo(e+s,i+o-h.lowerRight),t.quadraticCurveTo(e+s,i+o,e+s-h.lowerRight,i+o),t.lineTo(e+h.lowerLeft,i+o),t.quadraticCurveTo(e,i+o,e,i+o-h.lowerLeft),t.lineTo(e,i+h.upperLeft),t.quadraticCurveTo(e,i,e+h.upperLeft,i),t.closePath(),r&&t.fill()},N=.95,G=function(t){function i(e,i,s){var o=e.x,n=e.y,r=t.call(this,o,n,w,50)||this;return r.MAX_SPEED=s,r.angle=90*Math.PI/2,r.shotAvailable=!0,r.decelerateScalars={x:0,y:0},r.ACCELERATION_RATE=.1,r.accelerating=!1,r.bullets=[],r.velocity={x:0,y:0},r.IMAGE=i,r.CONVEX_POLYGONS=r.getPolygons(),r.BOUNDING_BOX=new k([{x:o,y:n},{x:o,y:n+r.height},{x:o+r.width,y:n+r.height},{x:o+r.width,y:n}],{x:r.x+r.width/2,y:r.y+r.height/2}),r.colliding=!1,r}return _(i,t),i.getStartPos=function(t){function i(){return{x:Math.floor(Math.random()*(window.innerWidth-50)),y:Math.floor(Math.random()*(.4*window.innerHeight-w)+.3*window.innerHeight)}}for(var s=i(),o=s.x,n=s.y,r=new e(o,n,w,50),a=!1;!a;){for(var h=0;h<t.length;h++)if(p(r,t[h])){var c=i(),l=c.x,u=c.y;r=new e(l,u,w,50)}a=!0}return{x:r.x,y:r.y}},i.prototype.move=function(t){switch(t){case"left":this.resetDeceleration("x"),this.velocity.x-=this.ACCELERATION_RATE*this.MAX_SPEED,this.velocity.x<-this.MAX_SPEED&&(this.velocity.x=-this.MAX_SPEED);break;case"right":this.resetDeceleration("x"),this.velocity.x+=this.ACCELERATION_RATE*this.MAX_SPEED,this.velocity.x>this.MAX_SPEED&&(this.velocity.x=this.MAX_SPEED);break;case"up":this.resetDeceleration("y"),this.velocity.y-=this.ACCELERATION_RATE*this.MAX_SPEED,this.velocity.y<-this.MAX_SPEED&&(this.velocity.y=-this.MAX_SPEED);break;case"down":this.resetDeceleration("y"),this.velocity.y+=this.ACCELERATION_RATE*this.MAX_SPEED,this.velocity.y>this.MAX_SPEED&&(this.velocity.y=this.MAX_SPEED)}},i.prototype.handleBoundsCollision=function(t){for(var e=function(t){for(var e=1/0,i=0,s=1/0,o=0,n=0;n<t.length;n++)t[n].x<s&&(s=t[n].x),t[n].y<e&&(e=t[n].y),t[n].x>i&&(i=t[n].x),t[n].y>o&&(o=t[n].y);return{top:e,left:s,right:i,bottom:o}}(this.BOUNDING_BOX.vertices),i=0,s=Object.entries(e);i<s.length;i++){var o=s[i],n=o[0],r=o[1];switch(n){case"top":r<0&&(this.updateYPosition(0-r),this.velocity.y=-this.velocity.y*N,this.resetDeceleration("x"),this.resetDeceleration("y"));break;case"left":r<0&&(this.updateXPosition(0-r),this.velocity.x=-this.velocity.x*N,this.resetDeceleration("x"),this.resetDeceleration("y"));break;case"bottom":r>t.y&&(this.updateYPosition(t.y-r),this.velocity.y=-this.velocity.y*N,this.resetDeceleration("x"),this.resetDeceleration("y"));break;case"right":r>t.x&&(this.updateXPosition(t.x-r),this.velocity.x=-this.velocity.x*N,this.resetDeceleration("x"),this.resetDeceleration("y"))}}},i.prototype.handleCollisionWithCircle=function(t){if(!(0===t.height||this.x+200<t.x||this.x>t.x+t.width+200||this.y+200<t.y||this.y>t.y+t.height+200)){for(var e,i=0,s=this.CONVEX_POLYGONS;i<s.length&&!(e=x(s[i],t));i++);if(e){var o=e.displacement,n=e.collisionNormal;this.updateXPosition(o.x),this.updateYPosition(o.y),n.normalize();var r=n.dot(this.velocity);this.velocity.x-=2*r*n.x,this.velocity.y-=2*r*n.y,this.velocity.x*=N,this.velocity.y*=N,this.resetDeceleration("x"),this.resetDeceleration("y")}}},i.prototype.handleCollisionWithRect=function(t){if(!(0===t.height||this.x+200<t.x||this.x>t.x+t.width+200||this.y+200<t.y||this.y>t.y+t.height+200)){for(var e,i=0,s=this.CONVEX_POLYGONS;i<s.length&&!(e=g(s[i],t));i++);if(e){var o=e.displacement,n=e.collisionNormal;this.updateXPosition(-o.x),this.updateYPosition(-o.y),Math.abs(n.y)>Math.abs(n.x)?this.velocity.y=-this.velocity.y*N:this.velocity.x=-this.velocity.x*N,this.resetDeceleration("x"),this.resetDeceleration("y")}}},i.prototype.updateXPosition=function(t){void 0===t&&(t=this.velocity.x),this.x+=t,this.BOUNDING_BOX.updateXPosition(t);for(var e=0,i=this.CONVEX_POLYGONS;e<i.length;e++)i[e].updateXPosition(t)},i.prototype.updateYPosition=function(t){void 0===t&&(t=this.velocity.y),this.y+=t,this.BOUNDING_BOX.updateYPosition(t);for(var e=0,i=this.CONVEX_POLYGONS;e<i.length;e++)i[e].updateYPosition(t)},i.prototype.shoot=function(){if(this.shotAvailable){var t=this.getCenter(),e=this.height/2,i=Math.cos(this.angle+Math.PI/2),s=Math.sin(this.angle+Math.PI/2);this.bullets.push(new a({x:e*i+t.x,y:e*s+t.y},{x:i,y:s})),this.shotAvailable=!1}},i.prototype.getCenter=function(){return{x:this.x+this.width/2,y:this.y+this.height/2}},i.prototype.draw=function(t){var e=this.getCenter(),i=e.x,s=e.y;t.setTransform(1,0,0,1,0,0),t.translate(i,s),t.rotate(this.angle),t.translate(-i,-s),t.drawImage(this.IMAGE,this.x,this.y,this.width,this.height),t.setTransform(1,0,0,1,0,0),(this.accelerating||this.decelerateScalars.x>0&&this.decelerateScalars.x<1||this.decelerateScalars.y>0&&this.decelerateScalars.y<1)&&this.drawFlames(t)},i.prototype.drawFlames=function(t){var e=this.getCenter(),i=e.x,s=e.y;t.setTransform(1,0,0,1,0,0),t.translate(i,s),t.rotate(this.angle),t.translate(-i,-s);var o=40*Math.max(Math.abs(this.velocity.x/this.MAX_SPEED),Math.abs(this.velocity.y/this.MAX_SPEED));t.fillStyle="#F18805",U(t,this.x+27,this.y-5-o/1.5,3,o/1.5,{upperLeft:2,upperRight:2},!0,!0),U(t,this.x+19,this.y-5-o/1.5,3,o/1.5,{upperLeft:2,upperRight:2},!0,!0),U(t,this.x+23,this.y-5-o,3,o,{upperLeft:2,upperRight:2},!0,!0),t.setTransform(1,0,0,1,0,0)},i.prototype.alignToMouse=function(t){if(null!==t.x&&null!==t.y){var e=this.getCenter(),i=t.x-e.x,s=t.y-e.y,o=Math.atan2(s,i)-Math.PI/2;this.angle=o,this.BOUNDING_BOX.rotate(o,e);for(var n=0,r=this.CONVEX_POLYGONS;n<r.length;n++)r[n].rotate(o,e)}},i.prototype.resetDeceleration=function(t){this.decelerateScalars[t]=0},i.prototype.decelerate=function(t){var e;this.decelerateScalars[t]>.92||(this.decelerateScalars[t]<.92&&(this.decelerateScalars[t]+=.05),this.velocity[t]-=(e=this.decelerateScalars[t],(1-Math.sqrt(1-Math.pow(e,3)))*this.velocity[t]))},i.prototype.removeBullet=function(t){this.bullets.splice(t,1)},i.prototype.getVerticesBoundingBox=function(){var t=this.x,e=this.y;return[{x:t,y:e},{x:t,y:e+this.height},{x:t+this.width,y:e},{x:t+this.width,y:e+this.height}]},i.prototype.getPolygons=function(){var t={x:(this.x+this.x+this.width)/2,y:this.y+this.height},e={x:t.x-12,y:this.y+this.height-33},i={x:t.x+12,y:this.y+this.height-33},s={x:this.x,y:this.y+10},o={x:this.x+this.width,y:this.y+10},n={x:this.x,y:s.y+30},r={x:this.x+this.width,y:s.y+30},a={x:e.x,y:n.y},h={x:i.x,y:n.y},c={x:a.x,y:this.y},l={x:h.x,y:this.y},u={x:a.x,y:s.y},A={x:h.x,y:o.y},p=[n,s,o,r],y=[u,c,l,A];return[new k([i,t,e,a,h],{x:(e.x+i.x)/2,y:t.y-(t.y-a.y)/2}),new k(p,{x:(n.x+r.x)/2,y:(n.y+s.y)/2}),new k(y,{x:(u.x+A.x)/2,y:(u.y+l.y)/2})]},i}(e);!function(){function t(t,e,i,s){this.scrollBoundary={top:.3*window.innerHeight,bottom:.7*window.innerHeight},this.boundaries=new M,this.bounds={x:window.innerWidth,y:window.innerHeight},this.spaceship=new G(G.getStartPos(this.boundaries.list),e,i),this.shootables=new I,this.keyPress=new P,this.mouse={x:null,y:null},this.REMOVE_CLASS=t,this.ROOT_EL=s,this.score=new O}t.prototype.updateBounds=function(t){this.bounds.x=t.x,this.bounds.y=t.y},t.prototype.update=function(){var t;this.spaceship.alignToMouse(this.mouse);for(var e=!1,i=!1,s=0,o=m;s<o.length;s++)t=o[s],this.keyPress.keys[t].pressed&&(this.spaceship.move(t),"right"===t||"left"===t?e=!0:i=!0);i||this.spaceship.decelerate("y"),e||this.spaceship.decelerate("x"),this.keyPress.keys.click.pressed&&this.spaceship.shoot();var n,r,a=Math.floor(document.documentElement.scrollHeight-window.innerHeight),h=(n=this.ROOT_EL,r=window.getComputedStyle(n),new WebKitCSSMatrix(r.transform).m42),c=Math.floor(-1*h)+window.scrollY,l=this.spaceship.y+this.spaceship.velocity.y>this.scrollBoundary.top&&this.spaceship.y+this.spaceship.velocity.y<this.scrollBoundary.bottom,u=c<=0&&this.spaceship.y+this.spaceship.velocity.y<this.scrollBoundary.bottom,A=c>=a&&this.spaceship.y+this.spaceship.velocity.y>this.scrollBoundary.top,d=this.spaceship.y>this.scrollBoundary.bottom&&this.spaceship.velocity.y<0,f=this.spaceship.y<this.scrollBoundary.top&&this.spaceship.velocity.y>0,g=0;if(l||u||A)this.spaceship.updateYPosition();else if(this.spaceship.y<this.scrollBoundary.bottom&&this.spaceship.y+this.spaceship.velocity.y>this.scrollBoundary.bottom){var v=h-this.spaceship.velocity.y;c+this.spaceship.velocity.y<a?(this.ROOT_EL.style.transform="translateY(".concat(v,"px)"),g=this.spaceship.velocity.y):(this.ROOT_EL.style.transform="translateY(".concat(-Math.ceil(a-window.scrollY),"px)"),this.spaceship.updateYPosition())}else this.spaceship.y>this.scrollBoundary.top&&this.spaceship.y+this.spaceship.velocity.y<this.scrollBoundary.top?(v=h-this.spaceship.velocity.y)<window.scrollY?(this.ROOT_EL.style.transform="translateY(".concat(v,"px)"),g=this.spaceship.velocity.y):(this.ROOT_EL.style.transform="translateY(".concat(window.scrollY,"px)"),this.spaceship.updateYPosition()):(d||f)&&this.spaceship.updateYPosition();this.spaceship.handleBoundsCollision(this.bounds),this.spaceship.updateXPosition(),this.score.updateDisplay();for(var x=Math.max(this.shootables.list.length,this.boundaries.list.length,this.spaceship.bullets.length);x>=0;x--){if(x<this.spaceship.bullets.length){var w=this.spaceship.bullets[x];if(w.y-=g,w.update(this.bounds),"dead"===w.status)this.spaceship.removeBullet(x);else if("alive"==w.status)for(var b=0,E=this.shootables.list;b<E.length;b++){var C=(M=E[b]).circle?y(M,w):p(M,w),S=Math.abs(w.velocity.y)>Math.abs(w.velocity.x)?"y":"x";C&&(w.onHit(),M.onHit(S))}}var M;if(x<this.shootables.list.length&&((M=this.shootables.list[x]).update(),M.lifePoints<=0&&(this.score.updateTotal(M),this.shootables.removeEl(x,this.REMOVE_CLASS))),x<this.boundaries.list.length){var B=this.boundaries.list[x];"circle"===B.kind?this.spaceship.handleCollisionWithCircle(B):this.spaceship.handleCollisionWithRect(B),B.update(),B.el.classList.contains(this.REMOVE_CLASS)&&this.boundaries.removeBoundary(x)}}}}();var Y=function(){function t(t,e){this.bounds=e,this.spaceship=new G(t.startPos,t.image,t.speed),this.score=new O,this.mouse={x:null,y:null},this.keyPress=new P}return t.prototype.updateBounds=function(t){this.bounds.x=t.x,this.bounds.y=t.y},t.prototype.update=function(t,e,i,s,o){var n;this.spaceship.alignToMouse(this.mouse);for(var r=!1,a=!1,h=0,c=m;h<c.length;h++)n=c[h],this.keyPress.keys[n].pressed&&(this.spaceship.move(n),"right"===n||"left"===n?r=!0:a=!0);a||this.spaceship.decelerate("y"),r||this.spaceship.decelerate("x"),this.keyPress.keys.click.pressed&&this.spaceship.shoot();var l=.3*this.bounds.y,u=.7*this.bounds.y,A=Math.floor(-1*t)+i,d=this.spaceship.y+this.spaceship.velocity.y>l&&this.spaceship.y+this.spaceship.velocity.y<u,f=A<=0&&this.spaceship.y+this.spaceship.velocity.y<u,g=A>=e&&this.spaceship.y+this.spaceship.velocity.y>l,v=this.spaceship.y>u&&this.spaceship.velocity.y<0,x=this.spaceship.y<l&&this.spaceship.velocity.y>0,w=this.spaceship.y<u&&this.spaceship.y+this.spaceship.velocity.y>u,b=this.spaceship.y>l&&this.spaceship.y+this.spaceship.velocity.y<l,E=0,C=null;d||f||g?this.spaceship.updateYPosition():w?A+this.spaceship.velocity.y<e?(C=t-this.spaceship.velocity.y,E=this.spaceship.velocity.y):(C=e-i,this.spaceship.updateYPosition()):b?(C=t-this.spaceship.velocity.y)<i?E=this.spaceship.velocity.y:(C=i,this.spaceship.updateYPosition()):(v||x)&&this.spaceship.updateYPosition(),this.spaceship.handleBoundsCollision(this.bounds),this.spaceship.updateXPosition(),this.score.updateDisplay();for(var S=Array(s.length).fill(void 0),M=Math.max(s.length,o.length,this.spaceship.bullets.length);M>=0;M--){if(M<this.spaceship.bullets.length){var B=this.spaceship.bullets[M];if(B.y-=E,B.update(this.bounds),"dead"===B.status)this.spaceship.removeBullet(M);else if("alive"==B.status)for(var P in s){var O=s[P],T=O.circle?y(O,B):p(O,B),R=Math.abs(B.velocity.y)>Math.abs(B.velocity.x)?"y":"x";T&&(B.onHit(),S[P]=R)}}if(M<o.length){var I=o[M];"circle"===I.kind?this.spaceship.handleCollisionWithCircle(I):this.spaceship.handleCollisionWithRect(I)}}return{shootablesHitAxis:S,newRootElTranslateValue:C}},t}(),D={active:!1,gameState:null,offscreenCanvas:null};return self.onmessage=function(t){return e=void 0,s=void 0,n=function(){var e,s,o,n,a;return function(t,e){var i,s,o,n,r={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return n={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function a(n){return function(a){return function(n){if(i)throw new TypeError("Generator is already executing.");for(;r;)try{if(i=1,s&&(o=2&n[0]?s.return:n[0]?s.throw||((o=s.return)&&o.call(s),0):s.next)&&!(o=o.call(s,n[1])).done)return o;switch(s=0,o&&(n=[2&n[0],o.value]),n[0]){case 0:case 1:o=n;break;case 4:return r.label++,{value:n[1],done:!1};case 5:r.label++,s=n[1],n=[0];continue;case 7:n=r.ops.pop(),r.trys.pop();continue;default:if(!((o=(o=r.trys).length>0&&o[o.length-1])||6!==n[0]&&2!==n[0])){r=0;continue}if(3===n[0]&&(!o||n[1]>o[0]&&n[1]<o[3])){r.label=n[1];break}if(6===n[0]&&r.label<o[1]){r.label=o[1],o=n;break}if(o&&r.label<o[2]){r.label=o[2],r.ops.push(n);break}o[2]&&r.ops.pop(),r.trys.pop();continue}n=e.call(t,r)}catch(t){n=[6,t],s=0}finally{i=o=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,a])}}}(this,(function(c){switch(c.label){case 0:switch((e=t.data).event){case"init":return[3,1];case"update":return[3,3];case"key toggle":return[3,4];case"mouse":return[3,5];case"shoot":return[3,6];case"reset shoot":return[3,7];case"resize":return[3,8]}return[3,9];case 1:return[4,(l=void 0,u=void 0,A=void 0,p=function(){var t,e,s,o,n,a,h,c,l,u,A,p,y,d,f,g,v;return function(t,e){var i,s,o,n,r={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return n={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function a(n){return function(a){return function(n){if(i)throw new TypeError("Generator is already executing.");for(;r;)try{if(i=1,s&&(o=2&n[0]?s.return:n[0]?s.throw||((o=s.return)&&o.call(s),0):s.next)&&!(o=o.call(s,n[1])).done)return o;switch(s=0,o&&(n=[2&n[0],o.value]),n[0]){case 0:case 1:o=n;break;case 4:return r.label++,{value:n[1],done:!1};case 5:r.label++,s=n[1],n=[0];continue;case 7:n=r.ops.pop(),r.trys.pop();continue;default:if(!((o=(o=r.trys).length>0&&o[o.length-1])||6!==n[0]&&2!==n[0])){r=0;continue}if(3===n[0]&&(!o||n[1]>o[0]&&n[1]<o[3])){r.label=n[1];break}if(6===n[0]&&r.label<o[1]){r.label=o[1],o=n;break}if(o&&r.label<o[2]){r.label=o[2],r.ops.push(n);break}o[2]&&r.ops.pop(),r.trys.pop();continue}n=e.call(t,r)}catch(t){n=[6,t],s=0}finally{i=o=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,a])}}}(this,(function(x){switch(x.label){case 0:return v={},t=createImageBitmap,[4,i("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACIAAAAhAQMAAACGHesvAAAABlBMVEUAAACzudGmrA41AAAAAXRSTlMAQObYZgAAAERJREFUCNdjIApI/AGR9v+bgWT9/8Ng8gFY5AOY/QNI/v//B5Vk/P//H34SUxfENLjJ98G2nP9/AEiy/28AOeIPNvcBACTVPFXC6MUWAAAAAElFTkSuQmCC")];case 1:return[4,t.apply(void 0,[x.sent()])];case 2:return e=[x.sent()],s=createImageBitmap,[4,i("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACIAAAAhAQMAAACGHesvAAAABlBMVEUAAACzudGmrA41AAAAAXRSTlMAQObYZgAAAE9JREFUCNdjIAAS/oDI5/8bgOT5/weApPz/B0DS/v8HIFn//weQ/P8fqIjx//9/qCTz////8ZNo6mHkHzD5Ayz+AW4jP9h2drBLGP6guhIA3FhDEM5oXpUAAAAASUVORK5CYII=")];case 3:return[4,s.apply(void 0,[x.sent()])];case 4:return e=e.concat([x.sent()]),o=createImageBitmap,[4,i("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACIAAAAhAQMAAACGHesvAAAABlBMVEUAAACzudGmrA41AAAAAXRSTlMAQObYZgAAAEZJREFUCNdjIAAOIJEMf0AE+/8GIMn/HyQm//8BkLT//wFI1v//gUb+//8HPwlTyfwfRLLDyA9A8j7IZOZ+oC1gGyG24wQA/d82NPmujF8AAAAASUVORK5CYII=")];case 5:return[4,o.apply(void 0,[x.sent()])];case 6:return e=e.concat([x.sent()]),n=createImageBitmap,[4,i("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACIAAAAhAQMAAACGHesvAAAABlBMVEUAAACzudGmrA41AAAAAXRSTlMAQObYZgAAABhJREFUCNdjoCUwAJMVYPIPElkBlaUaAAAoJQNJNXYvYAAAAABJRU5ErkJggg==")];case 7:return[4,n.apply(void 0,[x.sent()])];case 8:return e=e.concat([x.sent()]),a=createImageBitmap,[4,i("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACIAAAAhAQMAAACGHesvAAAABlBMVEUAAACzudGmrA41AAAAAXRSTlMAQObYZgAAAENJREFUCNdjIApI/AGR9v8bgGT9/wNg8gFY5AOY/QNI/v//B5Vk/P//H34SUxfMNB6wyTzyYFv4wbawg0mGPwlY3AcABtc754WxHzoAAAAASUVORK5CYII=")];case 9:return[4,a.apply(void 0,[x.sent()])];case 10:return e=e.concat([x.sent()]),h=createImageBitmap,[4,i("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACIAAAAhAQMAAACGHesvAAAABlBMVEUAAACzudGmrA41AAAAAXRSTlMAQObYZgAAAE1JREFUCNdjIAAS/oDI5/97gOT5//eApPz/f0DS/j9Iov7/DyD5H8Rm/A8URyGZ////j5/E1AUyDWYy2JYPIBvBJD9YhB1MMvwxQHElAOohQwvTKXTPAAAAAElFTkSuQmCC")];case 11:return[4,h.apply(void 0,[x.sent()])];case 12:return e=e.concat([x.sent()]),c=createImageBitmap,[4,i("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACIAAAAhAQMAAACGHesvAAAABlBMVEUAAACzudGmrA41AAAAAXRSTlMAQObYZgAAAENJREFUCNdjIAAOQEk2EPUHRLL/bwCS/P9BMvL/HwBJ+/8fgGT9/x9o5P//f/CTmLoQpoFNzgfaArYRbDvERRJwEgEAiHw0FeJ5t38AAAAASUVORK5CYII=")];case 13:return[4,c.apply(void 0,[x.sent()])];case 14:return v.idle=e.concat([x.sent()]),l=createImageBitmap,[4,i("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACIAAAAhAQMAAACGHesvAAAABlBMVEUAAACzudGmrA41AAAAAXRSTlMAQObYZgAAAEdJREFUCNdjIA78ARHs/xuAJP//A0BS/v8DIGn//wOQrP//A0j+//8HlWT8//8ffhKiEoP8AZb9ACYfgMkDIHGw7QV/sDkPAOezPiq+d9/OAAAAAElFTkSuQmCC")];case 15:return[4,l.apply(void 0,[x.sent()])];case 16:return u=[x.sent()],A=createImageBitmap,[4,i("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACIAAAAhAQMAAACGHesvAAAABlBMVEUAAACzudGmrA41AAAAAXRSTlMAQObYZgAAAFVJREFUCNdjIATYQYQFfwOQrPkPIv9DyQNg8g+QrP//D0z+h5GM/0Ek83+QODNYDSNEJYJE6P2BTIJVfgDregC0G2wL+3cw+QFEMj9gbwCqOcCM6kgAgZA+8f5WVbYAAAAASUVORK5CYII=")];case 17:return[4,A.apply(void 0,[x.sent()])];case 18:return u=u.concat([x.sent()]),p=createImageBitmap,[4,i("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACIAAAAhAQMAAACGHesvAAAABlBMVEUAAACzudGmrA41AAAAAXRSTlMAQObYZgAAAGFJREFUCNd1yLENgCAUhOFHKOhgARNGYRU3kcnUzjUcgdICPe8RNRZ6xXfJL1+zSu8yLaopVuhKaO14C0YaABqbSbUJh4ibUCmwsQyq/Jku62NsBu3eITPI3rTzrRfD8toJE/cztlqcm2EAAAAASUVORK5CYII=")];case 19:return[4,p.apply(void 0,[x.sent()])];case 20:return u=u.concat([x.sent()]),y=createImageBitmap,[4,i("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACIAAAAhAQMAAACGHesvAAAABlBMVEUAAACzudGmrA41AAAAAXRSTlMAQObYZgAAAFRJREFUCNdjQAWMDQwMzGCSHYghJEgEC+ADk/Jg0h6krAJEMv4Dkcz/geI8zP/5gCT7f5AkOglSwwAlQbpkQFSFHdg0ZFIGZp0BmKyAkQfAIgegkgCfLxWWTbxToQAAAABJRU5ErkJggg==")];case 21:return[4,y.apply(void 0,[x.sent()])];case 22:return u=u.concat([x.sent()]),d=createImageBitmap,[4,i("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACIAAAAhAQMAAACGHesvAAAABlBMVEUAAACzudGmrA41AAAAAXRSTlMAQObYZgAAACpJREFUCNdjgIMDDAw8UJIowAwm2RsQJDN2hQZgsgKJNCDeZGbcyg4gSABNjAYKcMQ+2QAAAABJRU5ErkJggg==")];case 23:return[4,d.apply(void 0,[x.sent()])];case 24:return u=u.concat([x.sent()]),f=createImageBitmap,[4,i("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACIAAAAhAQMAAACGHesvAAAABlBMVEUAAACzudGmrA41AAAAAXRSTlMAQObYZgAAACRJREFUCNdjkGAAAQswacBAXVABJREgAU4SBgdABCOEbMCvFABKKwQzrjqa0AAAAABJRU5ErkJggg==")];case 25:return[4,f.apply(void 0,[x.sent()])];case 26:return u=u.concat([x.sent()]),g=createImageBitmap,[4,i("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACIAAAAhAQMAAACGHesvAAAABlBMVEUAAACzudGmrA41AAAAAXRSTlMAQObYZgAAABFJREFUCNdjoA04gCAJy1IOABfVAwGRkW2/AAAAAElFTkSuQmCC")];case 27:return[4,g.apply(void 0,[x.sent()])];case 28:return v.poof=u.concat([x.sent()]),r=v,[2]}}))},new(A||(A=Promise))((function(t,e){function i(t){try{o(p.next(t))}catch(t){e(t)}}function s(t){try{o(p.throw(t))}catch(t){e(t)}}function o(e){var o;e.done?t(e.value):(o=e.value,o instanceof A?o:new A((function(t){t(o)}))).then(i,s)}o((p=p.apply(l,u||[])).next())})))];case 2:return c.sent(),D.gameState=new Y(e.spaceshipConfig,e.bounds),D.offscreenCanvas=new h(e.offscreen,e.scoreColor),[3,9];case 3:return D.gameState?(s=D.gameState.update(e.rootElTranslateYValue,e.distanceFromTopViewportToBottomOfDoc,e.scrollY,e.shootables,e.boundaries),o=s.newRootElTranslateValue,n=s.shootablesHitAxis,D.offscreenCanvas.draw(e.windowDimensions,D.gameState.spaceship,D.gameState.score.display),self.postMessage({newRootElTranslateValue:o,shootablesHitAxis:n}),[3,9]):[2];case 4:return D.gameState.keyPress.keys[e.direction].pressed=e.isPressed,D.gameState.spaceship.accelerating=e.isPressed,[3,9];case 5:return D.gameState.mouse.x=e.pos.x,D.gameState.mouse.y=e.pos.y,[3,9];case 6:return D.gameState.keyPress.keys.click.pressed=!0,D.gameState.keyPress.keys.click.timer||D.gameState.keyPress.setTimer("click",(function(){return D.gameState.spaceship.shotAvailable=!0}),250),[3,9];case 7:return D.gameState.spaceship.shotAvailable=!0,D.gameState.keyPress.keys.click.pressed=!1,D.gameState.keyPress.keys.click.timer&&D.gameState.keyPress.removeTimer(),[3,9];case 8:return null===(a=D.gameState)||void 0===a||a.updateBounds({y:e.dimensions.height,x:e.dimensions.width}),[3,9];case 9:return[2]}var l,u,A,p}))},new((o=void 0)||(o=Promise))((function(t,i){function r(t){try{h(n.next(t))}catch(t){i(t)}}function a(t){try{h(n.throw(t))}catch(t){i(t)}}function h(e){var i;e.done?t(e.value):(i=e.value,i instanceof o?i:new o((function(t){t(i)}))).then(r,a)}h((n=n.apply(e,s||[])).next())}));var e,s,o,n},t})()));